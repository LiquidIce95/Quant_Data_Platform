{
	"name": "scala-ib-connector-dev",
	"build": { "dockerfile": "../Dockerfile", "context": "../../../" },

	"runArgs": [
		"--env-file",
		"./.devcontainer/.env.secrets"
	],

	"workspaceMount": "source=${localWorkspaceFolder}/../../..,target=/work,type=bind,consistency=cached",
	"workspaceFolder": "/work/services_streaming_lane/ib_connector/source",

	"mounts": [
		"source=${localEnv:HOME}/.ssh,target=/root/.ssh,type=bind,consistency=cached"
	],

	"remoteUser": "root",
	"updateRemoteUserUID": false,

	"postCreateCommand": "bash -lc 'set -euo pipefail && git config --global --add safe.directory /work && mkdir -p /work/services_streaming_lane/ib_connector/source/src/main/scala/category_schemas && cp -f /work/services_streaming_lane/avro_schema_registry/category_schemas/*.avsc /work/services_streaming_lane/ib_connector/source/src/main/scala/category_schemas/'",
	"postStartCommand": "bash -lc '/usr/local/bin/ibkr-entrypoint.sh true'",

	"containerEnv": {
		"IB_HOST": "127.0.0.1",
		"IB_PORT": "4002",
		"IB_CLIENT_ID": "1"
	},

	"customizations": {
		"vscode": {
			"extensions": [
				"scalameta.metals",
				"scala-lang.scala",
				"ms-python.debugpy",
				"ms-python.python",
				"ms-python.vscode-pylance",
				"ms-python.vscode-python-envs"
			],
			"settings": {
				"metals.serverVersion": "1.6.2"
			}
		}
	}
}

