apiVersion: v1
kind: Pod
metadata:
  name: ib-connector
  namespace: ${NAMESPACE_IB}
spec:
  containers:
    - name: ib-connector
      image: ib-connector:dev
      env:
        - name: KAFKA_BOOTSTRAP_SERVERS
          value: "${KAFKA_NAME}-kafka-bootstrap.${NAMESPACE_KAFKA}:9092"
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: JAVA_TOOL_OPTIONS
          value: "-Djavax.net.ssl.trustStore=/trust/ibkr_truststore.jks -Djavax.net.ssl.trustStorePassword=changeit -Djavax.net.ssl.trustStoreType=JKS -Djdk.internal.httpclient.disableHostnameVerification=true"
      volumeMounts:
        - name: trust
          mountPath: /trust
          readOnly: true
  volumes:
    - name: trust
      secret:
        secretName: ibkr-truststore
  nodeSelector:
    ${LBL_KEY}: ${LBL_VAL_KAFKA}
  restartPolicy: Always
